---
# 针对新装服务器部署mode和packages


- hosts: serverdb
  remote_user: root
  gather_facts: no

  tasks:
    - name: download mode
      get_url: url=http://www.ipms.cn:8090/mode.tar.gz dest=/

    - name: download packages
      get_url: url=http://www.ipms.cn:8090/packages.tar.gz dest=/

    - name: tar zxvf mode
      unarchive: copy=no src=/mode.tar.gz dest=/

    - name: tar zxvf packages
      unarchive: copy=no src=/packages.tar.gz dest=/

    - name: inst_mode
      copy: src=/root/zhangh/inst_mode.py dest=/

    - name: python inst_mode.py
      shell: chdir=/ python inst_mode.py

    - name: rm inst_mode.py
      file: path=/inst_mode.py state=absent